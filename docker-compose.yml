# QuantumClaw + Cognee â€” full stack in one command
#
# Usage:
#   cp .env.example .env && edit .env   # add your API key
#   docker compose up -d                 # start everything
#   docker compose logs -f qclaw         # watch agent logs
#   docker compose down                  # stop everything
#
# First run:
#   docker compose run qclaw npx quantumclaw onboard
#
# Dashboard: http://localhost:3000

services:
  qclaw:
    build: .
    container_name: quantumclaw
    restart: unless-stopped
    ports:
      - "3000:3000"
    env_file:
      - .env
    environment:
      - COGNEE_API_URL=http://cognee:8000
    volumes:
      - ./workspace:/app/workspace
      - qclaw-config:/root/.quantumclaw
    depends_on:
      cognee:
        condition: service_healthy

  cognee:
    image: cognee/cognee:latest
    container_name: quantumclaw-cognee
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      - LLM_API_KEY=${LLM_API_KEY}
      - LLM_PROVIDER=${LLM_PROVIDER:-anthropic}
      - LLM_MODEL=${LLM_MODEL:-claude-sonnet-4-5-20250929}
      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER:-openai}
      - EMBEDDING_API_KEY=${EMBEDDING_API_KEY:-${LLM_API_KEY}}
      - EMBEDDING_MODEL=${EMBEDDING_MODEL:-text-embedding-3-small}
      - EMBEDDING_DIMENSIONS=${EMBEDDING_DIMENSIONS:-1536}
      - VECTOR_DB_PROVIDER=lancedb
      - ENABLE_BACKEND_ACCESS_CONTROL=false
    volumes:
      - cognee-data:/app/cognee/.cognee_system
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  qclaw-config:
  cognee-data:
